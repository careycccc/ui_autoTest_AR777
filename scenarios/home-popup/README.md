# é¦–é¡µå¼¹çª—å¤„ç†æ¨¡å—

## æ¦‚è¿°

æœ¬æ¨¡å—è´Ÿè´£å¤„ç†é¦–é¡µç™»å½•åå‡ºç°çš„å„ç§å¼¹çª—ï¼ŒåŒ…æ‹¬æ´»åŠ¨å¼¹çª—ã€å……å€¼å¼¹çª—ã€ä»»åŠ¡å¼¹çª—ç­‰ã€‚

## åŠŸèƒ½ç‰¹æ€§

### 1. æ™ºèƒ½å¼¹çª—è¯†åˆ«
- è‡ªåŠ¨ä» `/api/Home/GetCommonPopup` æ¥å£è·å–å¼¹çª—é…ç½®
- æ ¹æ®é…ç½®æ•°æ®æ™ºèƒ½åˆ¤æ–­å¼¹çª—ç±»å‹å’Œå¤„ç†æ–¹å¼
- æ”¯æŒé¡µé¢è·³è½¬ç±»å‹å’Œéè·³è½¬ç±»å‹å¼¹çª—

### 2. å¤šç§å¼¹çª—ç±»å‹æ”¯æŒ
- å……å€¼ (Deposit)
- æ´—ç  (Rebate)
- äºæŸæ•‘æ´é‡‘ (Loss Rebate)
- æ¯æ—¥ç­¾åˆ° (Daily deposit rewards)
- ä»»åŠ¡ (Tasks)
- VIP
- é”¦æ ‡èµ› (Championship)
- ä¼˜æƒ åˆ¸ (Coupons)
- æç° (Withdraw)
- å……å€¼æ”¯ä»˜å¯¹è¯æ¡† (Pay For The Order) - ç‰¹æ®Šå¤„ç†

### 3. å……å€¼æ”¯ä»˜å¼¹çª—ç‰¹æ®Šå¤„ç†

å……å€¼æ”¯ä»˜å¼¹çª—æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„äºŒçº§å¼¹çª—ï¼Œå®ƒä¸æ˜¯é€šè¿‡é¡µé¢è·³è½¬è§¦å‘çš„ï¼Œè€Œæ˜¯åœ¨ç‚¹å‡»é¦–é¡µå¼¹çª—å›¾ç‰‡åç›´æ¥å¼¹å‡ºçš„å¯¹è¯æ¡†ã€‚

#### å¼¹çª—ç‰¹å¾
- ç±»å: `.dialog-overlay.recharge-dialog`
- æ ‡é¢˜: "Pay For The Order"
- åŒ…å«æ”¯ä»˜æ–¹å¼åˆ—è¡¨å’Œç¡®è®¤æŒ‰é’®
- æœ‰å…³é—­æŒ‰é’® `.close-btn`

#### å¤„ç†æµç¨‹
1. ç‚¹å‡»é¦–é¡µå¼¹çª—å›¾ç‰‡åï¼Œç³»ç»Ÿè‡ªåŠ¨æ£€æµ‹æ˜¯å¦å‡ºç°å……å€¼æ”¯ä»˜å¼¹çª—
2. å¦‚æœæ£€æµ‹åˆ°ï¼Œè‡ªåŠ¨ç‚¹å‡»å…³é—­æŒ‰é’®
3. éªŒè¯å¼¹çª—å·²å…³é—­
4. ç»§ç»­å¤„ç†åç»­æµç¨‹

#### æ—¥å¿—ç¤ºä¾‹
```
ğŸ–¼ï¸ ç‚¹å‡»å¼¹çª—å›¾ç‰‡ (.popup_img)...
ğŸ’³ æ£€æµ‹åˆ°å……å€¼æ”¯ä»˜å¼¹çª—ï¼Œå¤„ç†ä¸­...
ğŸ¯ å¤„ç†å……å€¼æ”¯ä»˜å¼¹çª—...
âœ“ é€šè¿‡é€‰æ‹©å™¨ ".dialog-overlay.recharge-dialog" æ£€æµ‹åˆ°å……å€¼æ”¯ä»˜å¼¹çª—
ğŸ–±ï¸ ç‚¹å‡»å…³é—­æŒ‰é’® (.close-btn)...
âœ“ å·²ç‚¹å‡»å…³é—­æŒ‰é’®
âœ… å……å€¼æ”¯ä»˜å¼¹çª—å·²å…³é—­
âœ… å……å€¼æ”¯ä»˜å¼¹çª—å¤„ç†å®Œæˆ
```

## ä½¿ç”¨æ–¹æ³•

### åœ¨æµ‹è¯•ç”¨ä¾‹ä¸­ä½¿ç”¨

```javascript
import { AuthHelper } from '../src/utils/auth.js';

// ç™»å½•åæ£€æŸ¥å¹¶å¤„ç†é¦–é¡µå¼¹çª—
await auth.checkAndHandleHomePopups(20);
```

### æ·»åŠ æ–°çš„å¼¹çª—å¤„ç†

1. åœ¨ `scenarios/home-popup/` ç›®å½•ä¸‹åˆ›å»ºæ–°çš„å¤„ç†æ–‡ä»¶ï¼Œå¦‚ `new-popup.js`
2. å®ç°å¤„ç†å‡½æ•°ï¼š

```javascript
export async function handleNewPopup(page, auth, test) {
    console.log(`        ğŸ¯ å¤„ç†æ–°å¼¹çª—...`);
    
    try {
        // å¤„ç†é€»è¾‘
        return { success: true };
    } catch (error) {
        return { success: false, error: error.message };
    }
}
```

3. åœ¨ `index.js` ä¸­å¯¼å…¥å¹¶æ³¨å†Œï¼š

```javascript
import { handleNewPopup } from './new-popup.js';

export function getPopupHandler(assertText) {
    const handlers = {
        // ...
        'New Popup': handleNewPopup,
    };
    return handlers[assertText] || null;
}
```

4. åœ¨ `src/utils/auth.js` çš„ `_getAssertTextByJumpPage` æ–¹æ³•ä¸­æ·»åŠ æ˜ å°„ï¼š

```javascript
_getAssertTextByJumpPage(jumpPageText) {
    const jumpPageMap = {
        // ...
        "æ–°å¼¹çª—": "New Popup",
    };
    return jumpPageMap[jumpPageText] || null;
}
```

5. æ›´æ–° `MAPPING.md` æ–‡æ¡£

## æ–‡ä»¶ç»“æ„

```
scenarios/home-popup/
â”œâ”€â”€ index.js                      # ä¸»å…¥å£ï¼Œç»Ÿä¸€å¯¼å‡º
â”œâ”€â”€ deposit.js                    # å……å€¼
â”œâ”€â”€ rebate.js                     # æ´—ç 
â”œâ”€â”€ loss-rebate.js                # äºæŸæ•‘æ´é‡‘
â”œâ”€â”€ daily-deposit-rewards.js      # æ¯æ—¥ç­¾åˆ°
â”œâ”€â”€ tasks.js                      # æ¯æ—¥æ¯å‘¨ä»»åŠ¡
â”œâ”€â”€ uid.js                        # æˆ‘çš„
â”œâ”€â”€ deposit-wheel.js              # å……å€¼è½¬ç›˜
â”œâ”€â”€ my-rewards.js                 # æ–°ç‰ˆè¿”ä½£
â”œâ”€â”€ notifications.js              # ç«™å†…ä¿¡
â”œâ”€â”€ championship.js               # é”¦æ ‡èµ›
â”œâ”€â”€ vip.js                        # VIP
â”œâ”€â”€ super-jackpot.js              # è¶…çº§å¤§å¥–
â”œâ”€â”€ coupons.js                    # ä¼˜æƒ åˆ¸
â”œâ”€â”€ withdraw.js                   # æç°
â”œâ”€â”€ recharge-dialog.js            # å……å€¼æ”¯ä»˜å¯¹è¯æ¡†ï¼ˆç‰¹æ®Šå¤„ç†ï¼‰
â”œâ”€â”€ MAPPING.md                    # æ˜ å°„è¡¨æ–‡æ¡£
â””â”€â”€ README.md                     # æœ¬æ–‡æ¡£
```

## æ³¨æ„äº‹é¡¹

1. å……å€¼æ”¯ä»˜å¼¹çª—æ˜¯è‡ªåŠ¨æ£€æµ‹çš„ï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®
2. å¦‚æœå¼¹çª—å¤„ç†å¤±è´¥ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨é™çº§ä½¿ç”¨ä¼ ç»Ÿå¤„ç†æ–¹å¼
3. æ‰€æœ‰å¼¹çª—å¤„ç†å‡½æ•°éƒ½åº”è¯¥è¿”å› `{ success: boolean, error?: string }` æ ¼å¼çš„ç»“æœ
4. çˆ¶ç”¨ä¾‹é¡µé¢ï¼ˆå¦‚ Promotionsã€Homeï¼‰ä¼šè‡ªåŠ¨è·³è¿‡ï¼Œä¸è°ƒç”¨å¤„ç†å‡½æ•°

## è°ƒè¯•

å¦‚æœå¼¹çª—å¤„ç†å‡ºç°é—®é¢˜ï¼Œå¯ä»¥æŸ¥çœ‹æ—¥å¿—è¾“å‡ºï¼š

- `ğŸ“Š è·å–åˆ° X ä¸ªå¼¹çª—é…ç½®` - æˆåŠŸè·å–å¼¹çª—é…ç½®
- `âœ“ é€šè¿‡é€‰æ‹©å™¨ "xxx" æ£€æµ‹åˆ°å¼¹çª—` - æˆåŠŸæ£€æµ‹åˆ°å¼¹çª—
- `ğŸ’³ æ£€æµ‹åˆ°å……å€¼æ”¯ä»˜å¼¹çª—` - æ£€æµ‹åˆ°å……å€¼æ”¯ä»˜å¯¹è¯æ¡†
- `âŒ æ™ºèƒ½å¤„ç†å¼¹çª—å¤±è´¥` - æ™ºèƒ½å¤„ç†å¤±è´¥ï¼Œä¼šé™çº§ä½¿ç”¨ä¼ ç»Ÿæ–¹å¼
- `âš ï¸ _tryClosePopup å¤±è´¥` - ä¼ ç»Ÿæ–¹å¼ä¹Ÿå¤±è´¥ï¼Œä¼šå°è¯• dismissOverlay

## ç›¸å…³æ–‡æ¡£

- [MAPPING.md](./MAPPING.md) - å®Œæ•´çš„å¼¹çª—æ˜ å°„è¡¨
- [POPUP_HANDLING.md](../../POPUP_HANDLING.md) - å¼¹çª—å¤„ç†æœºåˆ¶è¯¦è§£
